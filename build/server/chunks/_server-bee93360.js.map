{"version":3,"file":"_server-bee93360.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/_publicID_/likes/_postID_/_server.js"],"sourcesContent":["import { g as getDBCollection } from \"../../../../../../chunks/mongo.js\";\nimport \"mongodb\";\nimport { e as error } from \"../../../../../../chunks/index.js\";\nconst initializeNewLike = (publicID, postID) => {\n  let newLike = {\n    publicID,\n    //public\n    postID,\n    //array of post ids\n    creationTimeStamp: Date.now()\n  };\n  return newLike;\n};\nasync function GET({ request, params, url, locals }) {\n  let publicID = params.publicID;\n  let postID = params.postID;\n  let postsCollection = await getDBCollection(\"likes\");\n  let postLike = await postsCollection.findOne({ publicID, postID });\n  let liked = postLike ? true : false;\n  return new Response(JSON.stringify(liked), { status: 200 });\n}\nasync function POST({ request, params, url, locals }) {\n  if (!locals.user) {\n    return error(409, \"Permission Denied\");\n  }\n  let id = locals.user.publicID;\n  let { postID, liked } = await request.json();\n  let likesCollection = await getDBCollection(\"likes\");\n  let postsCollection = await getDBCollection(\"posts\");\n  if (liked) {\n    let newLike = initializeNewLike(id, postID);\n    let confirmLike = await likesCollection.insertOne(newLike);\n    if (!confirmLike.acknowledged) {\n      return error(411, \"Unable to save to likes\");\n    }\n    let confirmPost = await postsCollection.updateOne({ postID }, { $addToSet: { likes: id } });\n    if (!confirmPost.acknowledged) {\n      return error(411, \"Unable to add to post likes\");\n    }\n  } else {\n    let confirmLike = await likesCollection.deleteOne({ publicID: id, postID });\n    if (!confirmLike.acknowledged) {\n      return error(411, \"Unable to delete from likes\");\n    }\n    let confirmPost = await postsCollection.updateOne({ postID }, { $pull: { likes: id } });\n    if (!confirmPost.acknowledged) {\n      return error(411, \"Unable to remove from post likes\");\n    }\n  }\n  return new Response(\"Success\", { status: 200 });\n}\nasync function PUT({ request, params, url, locals }) {\n  if (!locals.user) {\n    return error(409, \"Permission Denied\");\n  }\n  let id = locals.user.publicID;\n  let { postID } = await request.json();\n  let likesCollection = await getDBCollection(\"likes\");\n  let newLike = initializeNewLike(id, postID);\n  let confirmLike = await likesCollection.insertOne(newLike);\n  if (!confirmLike.acknowledged) {\n    return error(411, \"Unable to save to likes\");\n  }\n  let postsCollection = await getDBCollection(\"posts\");\n  let confirmPost = await postsCollection.updateOne({ postID }, { $pull: { likes: id } });\n  if (!confirmPost.acknowledged) {\n    return error(411, \"Unable to add to post likes\");\n  }\n  return new Response(\"Success\", { status: 200 });\n}\nexport {\n  GET,\n  POST,\n  PUT\n};\n"],"names":[],"mappings":"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"}