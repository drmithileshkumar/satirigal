{"version":3,"file":"_server-14bde56c.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/whatsapp/_server.js"],"sourcesContent":["import { s as signJwt } from \"../../../../chunks/jwt.js\";\nimport { g as getDBCollection } from \"../../../../chunks/mongo.js\";\nimport { i as initializeNewUser } from \"../../../../chunks/user.js\";\nimport qrcode from \"qrcode-generator\";\nimport \"../../../../chunks/index.js\";\nasync function POST({ params, request }) {\n  const { waName, waNumber } = await request.json();\n  const query = { phone: String(waNumber) };\n  let existingUser;\n  const usersCollection = await getDBCollection(\"users\");\n  existingUser = await usersCollection.findOne(query);\n  let qrlink = false;\n  if (!existingUser) {\n    let newUser = initializeNewUser(waName, String(waNumber), 0);\n    existingUser = newUser;\n    usersCollection.insertOne(newUser);\n    let qr = qrcode(10, \"H\");\n    qr.addData(newUser.privateID + \" \" + newUser.otpID);\n    qr.make();\n    qrlink = qr.createDataURL();\n  }\n  const user = {\n    publicID: existingUser.publicID,\n    name: existingUser.name,\n    phone: String(existingUser.phone),\n    profile: existingUser.profile,\n    likes: existingUser.likes,\n    qrlink\n  };\n  const jwt = signJwt(user);\n  const headers = new Headers();\n  headers.append(\"set-cookie\", [`jwt=${jwt}; Max-Age=${7 * 24 * 60 * 60}; Path=/;`]);\n  return new Response(JSON.stringify(user), { headers });\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;;;;;;;AAKA,eAAe,IAAI,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;AACzC,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AACpD,EAAE,MAAM,KAAK,GAAG,EAAE,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC;AAC5C,EAAE,IAAI,YAAY,CAAC;AACnB,EAAE,MAAM,eAAe,GAAG,MAAM,eAAe,CAAC,OAAO,CAAC,CAAC;AACzD,EAAE,YAAY,GAAG,MAAM,eAAe,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AACtD,EAAE,IAAI,MAAM,GAAG,KAAK,CAAC;AACrB,EAAE,IAAI,CAAC,YAAY,EAAE;AACrB,IAAI,IAAI,OAAO,GAAG,iBAAiB,CAAC,MAAM,EAAE,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;AACjE,IAAI,YAAY,GAAG,OAAO,CAAC;AAC3B,IAAI,eAAe,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;AACvC,IAAI,IAAI,EAAE,GAAG,MAAM,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC;AAC7B,IAAI,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,GAAG,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC;AACxD,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACd,IAAI,MAAM,GAAG,EAAE,CAAC,aAAa,EAAE,CAAC;AAChC,GAAG;AACH,EAAE,MAAM,IAAI,GAAG;AACf,IAAI,QAAQ,EAAE,YAAY,CAAC,QAAQ;AACnC,IAAI,IAAI,EAAE,YAAY,CAAC,IAAI;AAC3B,IAAI,KAAK,EAAE,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC;AACrC,IAAI,OAAO,EAAE,YAAY,CAAC,OAAO;AACjC,IAAI,KAAK,EAAE,YAAY,CAAC,KAAK;AAC7B,IAAI,MAAM;AACV,GAAG,CAAC;AACJ,EAAE,MAAM,GAAG,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AAC5B,EAAE,MAAM,OAAO,GAAG,IAAI,OAAO,EAAE,CAAC;AAChC,EAAE,OAAO,CAAC,MAAM,CAAC,YAAY,EAAE,CAAC,CAAC,IAAI,EAAE,GAAG,CAAC,UAAU,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;AACrF,EAAE,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC;AACzD;;;;"}