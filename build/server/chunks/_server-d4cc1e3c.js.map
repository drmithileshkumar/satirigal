{"version":3,"file":"_server-d4cc1e3c.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/profilepic/_server.js"],"sourcesContent":["import { a as getUsersCollection } from \"../../../../chunks/mongo.js\";\nimport { readFileSync, existsSync, mkdirSync, writeFileSync } from \"fs\";\nimport { e as error } from \"../../../../chunks/index.js\";\nasync function GET({ locals, request, params }) {\n  const publicID = locals.user.publicID;\n  const usersCollection = await getUsersCollection();\n  const user = await usersCollection.findOne({ publicID });\n  let path = user.profile;\n  let imageData = \"\";\n  if (!path || path.length === 0) {\n    return new Response(imageData, {\n      headers: {\n        \"Content-Type\": `image/png`\n        // \"cache-control\": \"public, max-age=31557600\"\n      }\n    });\n  }\n  const ext = path.split(\".\").slice(-1);\n  try {\n    imageData = readFileSync(\"./profile\" + path);\n    return new Response(imageData, {\n      headers: {\n        \"Content-Type\": `image/${ext}`,\n        \"cache-control\": \"public, max-age=3000\"\n      }\n    });\n  } catch (err) {\n    return new Response(imageData, {\n      headers: {\n        \"Content-Type\": `image/${ext}`,\n        \"cache-control\": \"public, max-age=3000\"\n      }\n    });\n  }\n}\nasync function POST({ locals, request }) {\n  const publicID = locals.user.publicID;\n  const data = await request.json();\n  let [part1, ext] = data[\"name\"].split(\".\");\n  let name = \"avatar.\" + ext;\n  const file = data[\"image\"];\n  const usersCollection = await getUsersCollection();\n  let dir = \"profile/\" + publicID;\n  try {\n    if (!existsSync(dir))\n      mkdirSync(dir);\n    writeFileSync(dir + `/${name}`, file, \"base64\");\n    let profile = \"/\" + publicID + `/${name}`;\n    const confirm = await usersCollection.updateOne({ publicID }, { $set: { profile } });\n    let status, message;\n    if (!confirm.acknowledged) {\n      status = 500;\n      message = \"Failed to update profile\";\n    }\n    status = 200;\n    message = \"Uploaded\";\n    return new Response(message, { status });\n  } catch (err) {\n    return error(500, \"Failed\");\n  }\n}\nexport {\n  GET,\n  POST\n};\n"],"names":[],"mappings":"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"}