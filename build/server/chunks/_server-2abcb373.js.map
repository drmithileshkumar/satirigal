{"version":3,"file":"_server-2abcb373.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/login/_server.js"],"sourcesContent":["import { s as signJwt } from \"../../../../chunks/jwt.js\";\nimport { a as getUsersCollection, g as getDBCollection } from \"../../../../chunks/mongo.js\";\nimport { i as initializeNewUserDetail } from \"../../../../chunks/userDetail.js\";\nimport { e as error } from \"../../../../chunks/index.js\";\nasync function POST({ locals, params, request }) {\n  const { phone, publicID, privateID, otpID } = await request.json();\n  const query = { publicID, privateID, otpID, phone: String(phone) };\n  let existingUser;\n  const usersCollection = await getUsersCollection();\n  existingUser = await usersCollection.findOne(query);\n  if (!existingUser) {\n    return error(400, \"User does not exist!\");\n  }\n  const user = {\n    publicID: existingUser.publicID,\n    name: existingUser.name,\n    phone: String(existingUser.phone),\n    profile: existingUser.profile,\n    banner: existingUser.banner\n  };\n  const userDetailsCollection = await getDBCollection(\"userDetails\");\n  let userDetail = await userDetailsCollection.findOne({ publicID });\n  if (!userDetail) {\n    let type = \"\";\n    let details = {\n      gender: \"\",\n      dob: \"\",\n      rank: \"\",\n      experience: 0,\n      established: \"\"\n    };\n    let common = {\n      bio: \"\",\n      email: \"\",\n      zip: \"\",\n      city: \"\",\n      country: \"\",\n      website: \"\",\n      followers: 0,\n      following: 0,\n      replies: 0,\n      shares: 0\n    };\n    let newUserDetail = initializeNewUserDetail(publicID, type, details, common);\n    await userDetailsCollection.insertOne(newUserDetail);\n    userDetail = newUserDetail;\n  }\n  const jwt = signJwt(user);\n  const headers = new Headers();\n  headers.append(\"set-cookie\", [`jwt=${jwt}; Max-Age=${7 * 24 * 60 * 60}; Path=/;`]);\n  return new Response(\"Success\", { headers });\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;;AAIA,eAAe,IAAI,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;AACjD,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AACrE,EAAE,MAAM,KAAK,GAAG,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC;AACrE,EAAE,IAAI,YAAY,CAAC;AACnB,EAAE,MAAM,eAAe,GAAG,MAAM,kBAAkB,EAAE,CAAC;AACrD,EAAE,YAAY,GAAG,MAAM,eAAe,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AACtD,EAAE,IAAI,CAAC,YAAY,EAAE;AACrB,IAAI,OAAO,KAAK,CAAC,GAAG,EAAE,sBAAsB,CAAC,CAAC;AAC9C,GAAG;AACH,EAAE,MAAM,IAAI,GAAG;AACf,IAAI,QAAQ,EAAE,YAAY,CAAC,QAAQ;AACnC,IAAI,IAAI,EAAE,YAAY,CAAC,IAAI;AAC3B,IAAI,KAAK,EAAE,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC;AACrC,IAAI,OAAO,EAAE,YAAY,CAAC,OAAO;AACjC,IAAI,MAAM,EAAE,YAAY,CAAC,MAAM;AAC/B,GAAG,CAAC;AACJ,EAAE,MAAM,qBAAqB,GAAG,MAAM,eAAe,CAAC,aAAa,CAAC,CAAC;AACrE,EAAE,IAAI,UAAU,GAAG,MAAM,qBAAqB,CAAC,OAAO,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC;AACrE,EAAE,IAAI,CAAC,UAAU,EAAE;AACnB,IAAI,IAAI,IAAI,GAAG,EAAE,CAAC;AAClB,IAAI,IAAI,OAAO,GAAG;AAClB,MAAM,MAAM,EAAE,EAAE;AAChB,MAAM,GAAG,EAAE,EAAE;AACb,MAAM,IAAI,EAAE,EAAE;AACd,MAAM,UAAU,EAAE,CAAC;AACnB,MAAM,WAAW,EAAE,EAAE;AACrB,KAAK,CAAC;AACN,IAAI,IAAI,MAAM,GAAG;AACjB,MAAM,GAAG,EAAE,EAAE;AACb,MAAM,KAAK,EAAE,EAAE;AACf,MAAM,GAAG,EAAE,EAAE;AACb,MAAM,IAAI,EAAE,EAAE;AACd,MAAM,OAAO,EAAE,EAAE;AACjB,MAAM,OAAO,EAAE,EAAE;AACjB,MAAM,SAAS,EAAE,CAAC;AAClB,MAAM,SAAS,EAAE,CAAC;AAClB,MAAM,OAAO,EAAE,CAAC;AAChB,MAAM,MAAM,EAAE,CAAC;AACf,KAAK,CAAC;AACN,IAAI,IAAI,aAAa,GAAG,uBAAuB,CAAC,QAAQ,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;AACjF,IAAI,MAAM,qBAAqB,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;AACzD,IAAI,UAAU,GAAG,aAAa,CAAC;AAC/B,GAAG;AACH,EAAE,MAAM,GAAG,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AAC5B,EAAE,MAAM,OAAO,GAAG,IAAI,OAAO,EAAE,CAAC;AAChC,EAAE,OAAO,CAAC,MAAM,CAAC,YAAY,EAAE,CAAC,CAAC,IAAI,EAAE,GAAG,CAAC,UAAU,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;AACrF,EAAE,OAAO,IAAI,QAAQ,CAAC,SAAS,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC;AAC9C;;;;"}