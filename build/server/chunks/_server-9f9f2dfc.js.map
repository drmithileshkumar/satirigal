{"version":3,"file":"_server-9f9f2dfc.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/_publicID_/media/_server.js"],"sourcesContent":["import { a as getUsersCollection } from \"../../../../../chunks/mongo.js\";\nimport { readFileSync, existsSync, mkdirSync, writeFileSync } from \"fs\";\nimport { e as error } from \"../../../../../chunks/index.js\";\nasync function GET({ locals, request, params, url }) {\n  const media = url.searchParams.get(\"media\");\n  let path = media;\n  let imageData = \"\";\n  if (!path || path.length === 0) {\n    return new Response(imageData, {\n      headers: {\n        \"Content-Type\": `image/png`\n        // \"cache-control\": \"public, max-age=31557600\"\n      }\n    });\n  }\n  const ext = path.split(\".\").slice(-1);\n  try {\n    imageData = readFileSync(\"./media\" + path);\n    return new Response(imageData, {\n      headers: {\n        \"Content-Type\": `image/${ext}`,\n        \"cache-control\": \"public, max-age=3000\"\n      }\n    });\n  } catch (err) {\n    return new Response(imageData, {\n      headers: {\n        \"Content-Type\": `image/${ext}`,\n        \"cache-control\": \"public, max-age=3000\"\n      }\n    });\n  }\n}\nasync function POST({ locals, request }) {\n  const publicID = locals.user.publicID;\n  const data = await request.json();\n  let name = data[\"name\"];\n  const file = data[\"image\"];\n  await getUsersCollection();\n  let dir = \"media/\" + publicID;\n  try {\n    if (!existsSync(dir))\n      mkdirSync(dir);\n    writeFileSync(dir + `/${name}`, file, \"base64\");\n    let mediaPath = \"/\" + publicID + `/${name}`;\n    let status, message;\n    status = 200;\n    message = \"Uploaded\";\n    return new Response(mediaPath, { status });\n  } catch (err) {\n    return error(500, \"Failed\");\n  }\n}\nexport {\n  GET,\n  POST\n};\n"],"names":[],"mappings":";;;;;AAGA,eAAe,GAAG,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,EAAE;AACrD,EAAE,MAAM,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AAC9C,EAAE,IAAI,IAAI,GAAG,KAAK,CAAC;AACnB,EAAE,IAAI,SAAS,GAAG,EAAE,CAAC;AACrB,EAAE,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;AAClC,IAAI,OAAO,IAAI,QAAQ,CAAC,SAAS,EAAE;AACnC,MAAM,OAAO,EAAE;AACf,QAAQ,cAAc,EAAE,CAAC,SAAS,CAAC;AACnC;AACA,OAAO;AACP,KAAK,CAAC,CAAC;AACP,GAAG;AACH,EAAE,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AACxC,EAAE,IAAI;AACN,IAAI,SAAS,GAAG,YAAY,CAAC,SAAS,GAAG,IAAI,CAAC,CAAC;AAC/C,IAAI,OAAO,IAAI,QAAQ,CAAC,SAAS,EAAE;AACnC,MAAM,OAAO,EAAE;AACf,QAAQ,cAAc,EAAE,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;AACtC,QAAQ,eAAe,EAAE,sBAAsB;AAC/C,OAAO;AACP,KAAK,CAAC,CAAC;AACP,GAAG,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,OAAO,IAAI,QAAQ,CAAC,SAAS,EAAE;AACnC,MAAM,OAAO,EAAE;AACf,QAAQ,cAAc,EAAE,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;AACtC,QAAQ,eAAe,EAAE,sBAAsB;AAC/C,OAAO;AACP,KAAK,CAAC,CAAC;AACP,GAAG;AACH,CAAC;AACD,eAAe,IAAI,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;AACzC,EAAE,MAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;AACxC,EAAE,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AACpC,EAAE,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;AAC1B,EAAE,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC;AAC7B,EAAE,MAAM,kBAAkB,EAAE,CAAC;AAC7B,EAAE,IAAI,GAAG,GAAG,QAAQ,GAAG,QAAQ,CAAC;AAChC,EAAE,IAAI;AACN,IAAI,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC;AACxB,MAAM,SAAS,CAAC,GAAG,CAAC,CAAC;AACrB,IAAI,aAAa,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;AACpD,IAAI,IAAI,SAAS,GAAG,GAAG,GAAG,QAAQ,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;AAChD,IAAI,IAAI,MAAM,EAAE,OAAO,CAAC;AACxB,IAAI,MAAM,GAAG,GAAG,CAAC;AACjB,IAAI,OAAO,GAAG,UAAU,CAAC;AACzB,IAAI,OAAO,IAAI,QAAQ,CAAC,SAAS,EAAE,EAAE,MAAM,EAAE,CAAC,CAAC;AAC/C,GAAG,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,OAAO,KAAK,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;AAChC,GAAG;AACH;;;;"}